{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
      "siteName": {
          "type": "string",
          "metadata": {
              "description": "Name of the site into which the function should be deployed"
          }
      },
      "functionName": {
          "type": "string",
          "metadata": {
              "description": "name of the function"
          },
          "defaultValue": "chefServerMetrics"
      },
      "logAnalyticsWorkspaceID": {
          "type": "string",
          "metadata": {
              "description": "The workspace ID to use when adding data to Log Analytics"
          }
      },
      "logAnalyticsSharedKey": {
          "type": "securestring",
          "metadata": {
              "description": "Primary key to use for authentication to Log Analytics"
          }
      },
      "logAnalyticsEnabled": {
          "type": "bool"
      }
  },
  "variables": {
      "name": {
          "site": "[parameters('siteName')]",
          "function": "[parameters('functionName')]"
      },
      "apiVersions": {
          "functions": "2016-08-01"
      },
      "code": {
          "ChefMetricMessage_csx": "dQBzAGkAbgBnACAAUwB5AHMAdABlAG0ALgBOAGUAdAA7AA0ACgB1AHMAaQBuAGcAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBSAGUAZwB1AGwAYQByAEUAeABwAHIAZQBzAHMAaQBvAG4AcwA7AA0ACgANAAoAcAB1AGIAbABpAGMAIABjAGwAYQBzAHMAIABDAGgAZQBmAE0AZQB0AHIAaQBjAE0AZQBzAHMAYQBnAGUAIAB7AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAARABhAHQAZQBUAGkAbQBlACAAdABpAG0AZQAgAHsAIABnAGUAdAA7ACAAcwBlAHQAOwAgAH0ADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABzAHQAcgBpAG4AZwAgAG4AYQBtAGUAIAB7ACAAZwBlAHQAOwAgAHMAZQB0ADsAIAB9AA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAcwB0AHIAaQBuAGcAIAB0AHkAcABlACAAewAgAGcAZQB0ADsAIABzAGUAdAA7ACAAfQANAAoAIAAgACAAIABwAHUAYgBsAGkAYwAgAHMAdAByAGkAbgBnACAAaABvAHMAdAAgAHsAIABnAGUAdAA7ACAAcwBlAHQAOwAgAH0ADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABkAG8AdQBiAGwAZQAgAHYAYQBsAHUAZQAgAHsAIABnAGUAdAA7ACAAcwBlAHQAOwAgAH0AIAANAAoAfQA=",
          "run_csx": "DQAKACMAcgAgACIATgBlAHcAdABvAG4AcwBvAGYAdAAuAEoAcwBvAG4AIgANAAoADQAKACMAbABvAGEAZAAgACIATABvAGcAQQBuAGEAbAB5AHQAaQBjAHMAVwByAGkAdABlAHIALgBjAHMAeAAiAA0ACgAjAGwAbwBhAGQAIAAiAEMAaABlAGYATQBlAHQAcgBpAGMATQBlAHMAcwBhAGcAZQAuAGMAcwB4ACIADQAKACMAbABvAGEAZAAgACIAdwBvAHIAawBzAHAAYQBjAGUALgBjAHMAeAAiAA0ACgANAAoAdQBzAGkAbgBnACAAUwB5AHMAdABlAG0AOwANAAoAdQBzAGkAbgBnACAATgBlAHcAdABvAG4AcwBvAGYAdAAuAEoAcwBvAG4AOwANAAoAdQBzAGkAbgBnACAATgBlAHcAdABvAG4AcwBvAGYAdAAuAEoAcwBvAG4ALgBMAGkAbgBxADsADQAKAA0ACgBwAHUAYgBsAGkAYwAgAHMAdABhAHQAaQBjACAAdgBvAGkAZAAgAFIAdQBuACgAcwB0AHIAaQBuAGcAIAByAGEAdwBtAGUAdAByAGkAYwAsACAAVAByAGEAYwBlAFcAcgBpAHQAZQByACAAbABvAGcAKQANAAoAewANAAoAIAAgACAAIABsAG8AZwAuAEkAbgBmAG8AKAAkACIAQwAjACAAUQB1AGUAdQBlACAAdAByAGkAZwBnAGUAcgAgAGYAdQBuAGMAdABpAG8AbgAgAHAAcgBvAGMAZQBzAHMAZQBkADoAIAB7AHIAYQB3AG0AZQB0AHIAaQBjAH0AIgApADsADQAKAA0ACgAgACAAIAAgAC8ALwAgAEkAbgBpAHQAYQBsAGkAcwBlACAAdgBhAHIAaQBhAGIAbABlAHMADQAKACAAIAAgACAAUwB5AHMAdABlAG0ALgBEAGEAdABlAFQAaQBtAGUAIABkAGEAdABlAFQAaQBtAGUAIAA9ACAAbgBlAHcAIABTAHkAcwB0AGUAbQAuAEQAYQB0AGUAVABpAG0AZQAoADEAOQA3ADAALAAgADEALAAgADEALAAgADAALAAgADAALAAgADAALAAgADAAKQA7AA0ACgAgACAAIAAgAEwAbwBnAEEAbgBhAGwAeQB0AGkAYwBzAFcAcgBpAHQAZQByACAAbABhAHcAIAA9ACAAbgBlAHcAIABMAG8AZwBBAG4AYQBsAHkAdABpAGMAcwBXAHIAaQB0AGUAcgAoAGMAdQBzAHQAbwBtAGUAcgBJAGQALAAgAHMAaABhAHIAZQBkAEsAZQB5ACwAIABsAG8AZwApADsADQAKAA0ACgAgACAAIAAgAC8ALwAgAFAAYQByAHMAZQAgAHQAaABlACAAcgBhAHcAIABtAGUAdAByAGkAYwAgAGoAcwBvAG4AIABpAG4AdABvACAAYQBuACAAbwBiAGoAZQBjAHQADQAKACAAIAAgACAATgBlAHcAdABvAG4AcwBvAGYAdAAuAEoAcwBvAG4ALgBMAGkAbgBxAC4ASgBPAGIAagBlAGMAdAAgAHMAdABhAHQAcwBkACAAPQAgAE4AZQB3AHQAbwBuAHMAbwBmAHQALgBKAHMAbwBuAC4ATABpAG4AcQAuAEoATwBiAGoAZQBjAHQALgBQAGEAcgBzAGUAKAByAGEAdwBtAGUAdAByAGkAYwApADsADQAKAA0ACgAgACAAIAAgAC8ALwAgAEkAdABlAHIAYQB0AGUAIABhAHIAbwB1AG4AZAAgAHQAaABlACAAcwBlAHIAaQBlAHMAIABkAGEAdABhACAAYQBuAGQAIABjAHIAZQBhAHQAZQAgAGEAIABtAGUAcwBzAGEAZwBlACAAZgBvAHIAIABlAGEAYwBoACAAbwBuAGUADQAKACAAIAAgACAAdgBhAHIAIABtAGUAdAByAGkAYwBzACAAPQAgACgASgBBAHIAcgBhAHkAKQAgAHMAdABhAHQAcwBkAFsAIgBzAGUAcgBpAGUAcwAiAF0AOwANAAoAIAAgACAAIABmAG8AcgBlAGEAYwBoACAAKABKAE8AYgBqAGUAYwB0ACAAbQBlAHQAcgBpAGMAIABpAG4AIABtAGUAdAByAGkAYwBzACkAIAB7AA0ACgANAAoAIAAgACAAIAAgACAAIAAgAC8ALwAgAGMAcgBlAGEAdABlACAAbQBlAHMAcwBhAGcAZQAgAHQAbwAgAHMAZQBuAGQAIAB0AG8AIABMAG8AZwAgAEEAbgBhAGwAeQB0AGkAYwBzAA0ACgAgACAAIAAgACAAIAAgACAAQwBoAGUAZgBNAGUAdAByAGkAYwBNAGUAcwBzAGEAZwBlACAAbQBlAHMAcwBhAGcAZQAgAD0AIABuAGUAdwAgAEMAaABlAGYATQBlAHQAcgBpAGMATQBlAHMAcwBhAGcAZQAoACkAOwANAAoADQAKACAAIAAgACAAIAAgACAAIAAvAC8AIABkAGUAdABlAHIAbQBpAG4AZQAgAHQAaABlACAAdABpAG0AZQAgAG8AZgAgAHQAaABlACAAZQB2AGUAbgB0AA0ACgAgACAAIAAgACAAIAAgACAARABhAHQAZQBUAGkAbQBlACAAdABpAG0AZQAgAD0AIABkAGEAdABlAFQAaQBtAGUALgBBAGQAZABTAGUAYwBvAG4AZABzACgAKABkAG8AdQBiAGwAZQApACAAbQBlAHQAcgBpAGMAWwAiAHAAbwBpAG4AdABzACIAXQBbADAAXQBbADAAXQApADsADQAKAA0ACgAgACAAIAAgACAAIAAgACAALwAvACAAcwBlAHQAIAB0AGgAZQAgAHAAcgBvAHAAZQByAHQAaQBlAHMAIABvAGYAIAB0AGgAZQAgAG8AYgBqAGUAYwB0AA0ACgAgACAAIAAgACAAIAAgACAAbQBlAHMAcwBhAGcAZQAuAG4AYQBtAGUAIAA9ACAAKABzAHQAcgBpAG4AZwApACAAbQBlAHQAcgBpAGMAWwAiAG0AZQB0AHIAaQBjACIAXQA7AA0ACgAgACAAIAAgACAAIAAgACAAbQBlAHMAcwBhAGcAZQAuAHQAeQBwAGUAIAA9ACAAKABzAHQAcgBpAG4AZwApACAAbQBlAHQAcgBpAGMAWwAiAHQAeQBwAGUAIgBdADsADQAKACAAIAAgACAAIAAgACAAIABtAGUAcwBzAGEAZwBlAC4AaABvAHMAdAAgAD0AIAAoAHMAdAByAGkAbgBnACkAIABtAGUAdAByAGkAYwBbACIAaABvAHMAdAAiAF0AOwANAAoAIAAgACAAIAAgACAAIAAgAG0AZQBzAHMAYQBnAGUALgB0AGkAbQBlACAAPQAgAHQAaQBtAGUAOwANAAoAIAAgACAAIAAgACAAIAAgAG0AZQBzAHMAYQBnAGUALgB2AGEAbAB1AGUAIAA9ACAAKABkAG8AdQBiAGwAZQApACAAbQBlAHQAcgBpAGMAWwAiAHAAbwBpAG4AdABzACIAXQBbADAAXQBbADEAXQA7AA0ACgANAAoAIAAgACAAIAAgACAAIAAgAC8ALwAgAFMAdQBiAG0AaQB0ACAAdABoAGUAIABtAGUAdAByAGkAYwAgAHQAbwAgAEwAbwBnACAAQQBuAGEAbAB5AHQAaQBjAHMADQAKACAAIAAgACAAIAAgACAAIABsAGEAdwAuAFMAdQBiAG0AaQB0ACgAbQBlAHMAcwBhAGcAZQAsACAAIgBzAHQAYQB0AHMAZABfAGwAbwBnACIAKQA7AA0ACgAgACAAIAAgAH0ADQAKAA0ACgB9AA0ACgA=",
          "LogAnalyticsWriter_csx": "IwByACAAIgBOAGUAdwB0AG8AbgBzAG8AZgB0AC4ASgBzAG8AbgAiAA0ACgB1AHMAaQBuAGcAIABTAHkAcwB0AGUAbQA7AA0ACgB1AHMAaQBuAGcAIABTAHkAcwB0AGUAbQAuAE4AZQB0ADsADQAKAHUAcwBpAG4AZwAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBIAHQAdABwADsADQAKAHUAcwBpAG4AZwAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBIAHQAdABwAC4ASABlAGEAZABlAHIAcwA7AA0ACgB1AHMAaQBuAGcAIABTAHkAcwB0AGUAbQAuAFMAZQBjAHUAcgBpAHQAeQAuAEMAcgB5AHAAdABvAGcAcgBhAHAAaAB5ADsADQAKAHUAcwBpAG4AZwAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAA7AA0ACgB1AHMAaQBuAGcAIABTAHkAcwB0AGUAbQAuAFQAaAByAGUAYQBkAGkAbgBnAC4AVABhAHMAawBzADsADQAKAHUAcwBpAG4AZwAgAE4AZQB3AHQAbwBuAHMAbwBmAHQALgBKAHMAbwBuADsADQAKAA0ACgBwAHUAYgBsAGkAYwAgAGMAbABhAHMAcwAgAEwAbwBnAEEAbgBhAGwAeQB0AGkAYwBzAFcAcgBpAHQAZQByACAAewANAAoAIAAgACAAIAAgACAAIAAgAC8ALwAgAFUAcABkAGEAdABlACAAYwB1AHMAdABvAG0AZQByAEkAZAAgAHQAbwAgAHkAbwB1AHIAIABPAHAAZQByAGEAdABpAG8AbgBzACAATQBhAG4AYQBnAGUAbQBlAG4AdAAgAFMAdQBpAHQAZQAgAHcAbwByAGsAcwBwAGEAYwBlACAASQBEAA0ACgAgACAAIAAgACAAIAAgACAAcwB0AHIAaQBuAGcAIABDAHUAcwB0AG8AbQBlAHIASQBkADsADQAKACAAIAAgACAAIAAgACAAIAAvAC8AIABGAG8AcgAgAHMAaABhAHIAZQBkAEsAZQB5ACwAIAB1AHMAZQAgAGUAaQB0AGgAZQByACAAdABoAGUAIABwAHIAaQBtAGEAcgB5ACAAbwByACAAdABoAGUAIABzAGUAYwBvAG4AZABhAHIAeQAgAEMAbwBuAG4AZQBjAHQAZQBkACAAUwBvAHUAcgBjAGUAcwAgAGMAbABpAGUAbgB0ACAAYQB1AHQAaABlAG4AdABpAGMAYQB0AGkAbwBuACAAawBlAHkAIAAgACAADQAKACAAIAAgACAAIAAgACAAIABzAHQAcgBpAG4AZwAgAFMAaABhAHIAZQBkAEsAZQB5ADsADQAKACAAIAAgACAAIAAgACAAIABUAHIAYQBjAGUAVwByAGkAdABlAHIAIABBAEYATABvAGcAOwANAAoADQAKACAAIAAgACAAcAB1AGIAbABpAGMAIABMAG8AZwBBAG4AYQBsAHkAdABpAGMAcwBXAHIAaQB0AGUAcgAoAHMAdAByAGkAbgBnACAAYwB1AHMAdABvAG0AZQByAEkAZAAsACAAcwB0AHIAaQBuAGcAIABzAGgAYQByAGUAZABLAGUAeQAsACAAVAByAGEAYwBlAFcAcgBpAHQAZQByACAAbABvAGcAKQB7AA0ACgAgACAAIAAgACAAIAAgACAAQwB1AHMAdABvAG0AZQByAEkAZAAgAD0AIABjAHUAcwB0AG8AbQBlAHIASQBkADsADQAKACAAIAAgACAAIAAgACAAIABTAGgAYQByAGUAZABLAGUAeQAgAD0AIABzAGgAYQByAGUAZABLAGUAeQA7AA0ACgAgACAAIAAgACAAIAAgACAAQQBGAEwAbwBnACAAPQAgAGwAbwBnADsADQAKACAAIAAgACAAIAAgACAAIABBAEYATABvAGcALgBJAG4AZgBvACgAQwB1AHMAdABvAG0AZQByAEkAZAApADsADQAKACAAIAAgACAAfQANAAoADQAKACAAIAAgACAALwAvACAAQgB1AGkAbABkACAAdABoAGUAIABBAFAASQAgAHMAaQBnAG4AYQB0AHUAcgBlAA0ACgAgACAAIAAgAHAAcgBpAHYAYQB0AGUAIABzAHQAcgBpAG4AZwAgAEIAdQBpAGwAZABTAGkAZwBuAGEAdAB1AHIAZQAoAHMAdAByAGkAbgBnACAAbQBlAHMAcwBhAGcAZQAsACAAcwB0AHIAaQBuAGcAIABzAGUAYwByAGUAdAApAA0ACgAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIAB2AGEAcgAgAGUAbgBjAG8AZABpAG4AZwAgAD0AIABuAGUAdwAgAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEEAUwBDAEkASQBFAG4AYwBvAGQAaQBuAGcAKAApADsADQAKACAAIAAgACAAIAAgACAAIABiAHkAdABlAFsAXQAgAGsAZQB5AEIAeQB0AGUAIAA9ACAAQwBvAG4AdgBlAHIAdAAuAEYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcAKABzAGUAYwByAGUAdAApADsADQAKACAAIAAgACAAIAAgACAAIABiAHkAdABlAFsAXQAgAG0AZQBzAHMAYQBnAGUAQgB5AHQAZQBzACAAPQAgAGUAbgBjAG8AZABpAG4AZwAuAEcAZQB0AEIAeQB0AGUAcwAoAG0AZQBzAHMAYQBnAGUAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAdQBzAGkAbgBnACAAKAB2AGEAcgAgAGgAbQBhAGMAcwBoAGEAMgA1ADYAIAA9ACAAbgBlAHcAIABIAE0AQQBDAFMASABBADIANQA2ACgAawBlAHkAQgB5AHQAZQApACkADQAKACAAIAAgACAAIAAgACAAIAB7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABiAHkAdABlAFsAXQAgAGgAYQBzAGgAIAA9ACAAaABtAGEAYwBzAGgAYQAyADUANgAuAEMAbwBtAHAAdQB0AGUASABhAHMAaAAoAG0AZQBzAHMAYQBnAGUAQgB5AHQAZQBzACkAOwANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAQQBGAEwAbwBnAC4ASQBuAGYAbwAoACIAaQBuACAAYgB1AGkAbABkACAAZgB1AG4AYwB0AGkAbwBuACAANQAiACkAOwANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAcgBlAHQAdQByAG4AIABDAG8AbgB2AGUAcgB0AC4AVABvAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAaABhAHMAaAApADsADQAKACAAIAAgACAAIAAgACAAIAB9AA0ACgAgACAAIAAgAH0ADQAKAA0ACgAgACAAIAAgAHAAcgBpAHYAYQB0AGUAIAB2AG8AaQBkACAAUABvAHMAdABEAGEAdABhACgAcwB0AHIAaQBuAGcAIABzAGkAZwBuAGEAdAB1AHIAZQAsACAAcwB0AHIAaQBuAGcAIABqAHMAbwBuACwAIABzAHQAcgBpAG4AZwAgAGwAbwBnAE4AYQBtAGUALAAgAHMAdAByAGkAbgBnACAAZABhAHQAZQAsACAAcwB0AHIAaQBuAGcAIAB0AGkAbQBlAHMAdABhAG0AcAAgAD0AIAAiACIAKQANAAoAIAAgACAAIAB7ACAAIAAgACAAIAAgACAADQAKACAAIAAgACAAIAAgACAAIAB0AHIAeQANAAoAIAAgACAAIAAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAHMAdAByAGkAbgBnACAAdQByAGwAIAA9ACAAIgBoAHQAdABwAHMAOgAvAC8AIgAgACsAIABDAHUAcwB0AG8AbQBlAHIASQBkACAAKwAgACIALgBvAGQAcwAuAG8AcABpAG4AcwBpAGcAaAB0AHMALgBhAHoAdQByAGUALgBjAG8AbQAvAGEAcABpAC8AbABvAGcAcwA/AGEAcABpAC0AdgBlAHIAcwBpAG8AbgA9ADIAMAAxADYALQAwADQALQAwADEAIgA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABBAEYATABvAGcALgBJAG4AZgBvACgAdQByAGwAKQA7AA0ACgAgACAAIAAgAA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABTAHkAcwB0AGUAbQAuAE4AZQB0AC4ASAB0AHQAcAAuAEgAdAB0AHAAQwBsAGkAZQBuAHQAIABjAGwAaQBlAG4AdAAgAD0AIABuAGUAdwAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBIAHQAdABwAC4ASAB0AHQAcABDAGwAaQBlAG4AdAAoACkAOwANAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAYwBsAGkAZQBuAHQALgBEAGUAZgBhAHUAbAB0AFIAZQBxAHUAZQBzAHQASABlAGEAZABlAHIAcwAuAEEAZABkACgAIgBBAGMAYwBlAHAAdAAiACwAIAAiAGEAcABwAGwAaQBjAGEAdABpAG8AbgAvAGoAcwBvAG4AIgApADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGMAbABpAGUAbgB0AC4ARABlAGYAYQB1AGwAdABSAGUAcQB1AGUAcwB0AEgAZQBhAGQAZQByAHMALgBBAGQAZAAoACIATABvAGcALQBUAHkAcABlACIALAAgAGwAbwBnAE4AYQBtAGUAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABjAGwAaQBlAG4AdAAuAEQAZQBmAGEAdQBsAHQAUgBlAHEAdQBlAHMAdABIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAiAEEAdQB0AGgAbwByAGkAegBhAHQAaQBvAG4AIgAsACAAcwBpAGcAbgBhAHQAdQByAGUAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABjAGwAaQBlAG4AdAAuAEQAZQBmAGEAdQBsAHQAUgBlAHEAdQBlAHMAdABIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAiAHgALQBtAHMALQBkAGEAdABlACIALAAgAGQAYQB0AGUAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABjAGwAaQBlAG4AdAAuAEQAZQBmAGEAdQBsAHQAUgBlAHEAdQBlAHMAdABIAGUAYQBkAGUAcgBzAC4AQQBkAGQAKAAiAHQAaQBtAGUALQBnAGUAbgBlAHIAYQB0AGUAZAAtAGYAaQBlAGwAZAAiACwAIAB0AGkAbQBlAHMAdABhAG0AcAApADsADQAKACAAIAAgACAADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBIAHQAdABwAC4ASAB0AHQAcABDAG8AbgB0AGUAbgB0ACAAaAB0AHQAcABDAG8AbgB0AGUAbgB0ACAAPQAgAG4AZQB3ACAAUwB0AHIAaQBuAGcAQwBvAG4AdABlAG4AdAAoAGoAcwBvAG4ALAAgAEUAbgBjAG8AZABpAG4AZwAuAFUAVABGADgAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABoAHQAdABwAEMAbwBuAHQAZQBuAHQALgBIAGUAYQBkAGUAcgBzAC4AQwBvAG4AdABlAG4AdABUAHkAcABlACAAPQAgAG4AZQB3ACAATQBlAGQAaQBhAFQAeQBwAGUASABlAGEAZABlAHIAVgBhAGwAdQBlACgAIgBhAHAAcABsAGkAYwBhAHQAaQBvAG4ALwBqAHMAbwBuACIAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABUAGEAcwBrADwAUwB5AHMAdABlAG0ALgBOAGUAdAAuAEgAdAB0AHAALgBIAHQAdABwAFIAZQBzAHAAbwBuAHMAZQBNAGUAcwBzAGEAZwBlAD4AIAByAGUAcwBwAG8AbgBzAGUAIAA9ACAAYwBsAGkAZQBuAHQALgBQAG8AcwB0AEEAcwB5AG4AYwAoAG4AZQB3ACAAVQByAGkAKAB1AHIAbAApACwAIABoAHQAdABwAEMAbwBuAHQAZQBuAHQAKQA7AA0ACgAgACAAIAAgAA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABTAHkAcwB0AGUAbQAuAE4AZQB0AC4ASAB0AHQAcAAuAEgAdAB0AHAAQwBvAG4AdABlAG4AdAAgAHIAZQBzAHAAbwBuAHMAZQBDAG8AbgB0AGUAbgB0ACAAPQAgAHIAZQBzAHAAbwBuAHMAZQAuAFIAZQBzAHUAbAB0AC4AQwBvAG4AdABlAG4AdAA7AA0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABzAHQAcgBpAG4AZwAgAHIAZQBzAHUAbAB0ACAAPQAgAHIAZQBzAHAAbwBuAHMAZQBDAG8AbgB0AGUAbgB0AC4AUgBlAGEAZABBAHMAUwB0AHIAaQBuAGcAQQBzAHkAbgBjACgAKQAuAFIAZQBzAHUAbAB0ADsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEEARgBMAG8AZwAuAEkAbgBmAG8AKAAiAFIAZQB0AHUAcgBuACAAUgBlAHMAdQBsAHQAOgAgACIAIAArACAAcgBlAHMAdQBsAHQAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAfQANAAoAIAAgACAAIAAgACAAIAAgAGMAYQB0AGMAaAAgACgARQB4AGMAZQBwAHQAaQBvAG4AIABlAHgAYwBlAHAAKQANAAoAIAAgACAAIAAgACAAIAAgAHsADQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAEEARgBMAG8AZwAuAEUAcgByAG8AcgAoACIAQQBQAEkAIABQAG8AcwB0ACAARQB4AGMAZQBwAHQAaQBvAG4AOgAgACIAIAArACAAZQB4AGMAZQBwAC4ATQBlAHMAcwBhAGcAZQApADsADQAKACAAIAAgACAAIAAgACAAIAB9AA0ACgAgACAAIAAgAH0ADQAKAA0ACgAgACAAIAAgAHAAdQBiAGwAaQBjACAAdgBvAGkAZAAgAFMAdQBiAG0AaQB0ACgAQwBoAGUAZgBNAGUAdAByAGkAYwBNAGUAcwBzAGEAZwBlACAAbQBlAHQAcgBpAGMATQBlAHMAcwBhAGcAZQAsACAAcwB0AHIAaQBuAGcAIABsAG8AZwBOAGEAbQBlACkAewANAAoAIAAgACAAIAAgACAAIAAgAHYAYQByACAAagBzAG8AbgAgAD0AIABKAHMAbwBuAEMAbwBuAHYAZQByAHQALgBTAGUAcgBpAGEAbABpAHoAZQBPAGIAagBlAGMAdAAoAG0AZQB0AHIAaQBjAE0AZQBzAHMAYQBnAGUAKQA7AA0ACgANAAoAIAAgACAAIAAgACAAIAAgAHYAYQByACAAZABhAHQAZQBzAHQAcgBpAG4AZwAgAD0AIABEAGEAdABlAFQAaQBtAGUALgBVAHQAYwBOAG8AdwAuAFQAbwBTAHQAcgBpAG4AZwAoACIAcgAiACkAOwANAAoAIAAgACAAIAAgACAAIAAgAHMAdAByAGkAbgBnACAAcwB0AHIAaQBuAGcAVABvAEgAYQBzAGgAIAA9ACAAIgBQAE8AUwBUAFwAbgAiACAAKwAgAGoAcwBvAG4ALgBMAGUAbgBnAHQAaAAgACsAIAAiAFwAbgBhAHAAcABsAGkAYwBhAHQAaQBvAG4ALwBqAHMAbwBuAFwAbgAiACAAKwAgACIAeAAtAG0AcwAtAGQAYQB0AGUAOgAiACAAKwAgAGQAYQB0AGUAcwB0AHIAaQBuAGcAIAArACAAIgBcAG4ALwBhAHAAaQAvAGwAbwBnAHMAIgA7AA0ACgAgACAAIAAgACAAIAAgACAAcwB0AHIAaQBuAGcAIABoAGEAcwBoAGUAZABTAHQAcgBpAG4AZwAgAD0AIABCAHUAaQBsAGQAUwBpAGcAbgBhAHQAdQByAGUAKABzAHQAcgBpAG4AZwBUAG8ASABhAHMAaAAsACAAUwBoAGEAcgBlAGQASwBlAHkAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAcwB0AHIAaQBuAGcAIABzAGkAZwBuAGEAdAB1AHIAZQAgAD0AIAAiAFMAaABhAHIAZQBkAEsAZQB5ACAAIgAgACsAIABDAHUAcwB0AG8AbQBlAHIASQBkACAAKwAgACIAOgAiACAAKwAgAGgAYQBzAGgAZQBkAFMAdAByAGkAbgBnADsADQAKAA0ACgAgACAAIAAgACAAIAAgACAAcwB0AHIAaQBuAGcAIAB0AGkAbQBlAHMAdABhAG0AcAAgAD0AIABtAGUAdAByAGkAYwBNAGUAcwBzAGEAZwBlAC4AdABpAG0AZQAuAFQAbwBTAHQAcgBpAG4AZwAoACIAeQB5AHkAeQAtAE0ATQAtAGQAZABUAGgAaAA6AG0AbQA6AHMAcwBaACIAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAQQBGAEwAbwBnAC4ASQBuAGYAbwAoAHQAaQBtAGUAcwB0AGEAbQBwACkAOwANAAoADQAKACAAIAAgACAAIAAgACAAIABBAEYATABvAGcALgBJAG4AZgBvACgAIgBzAHUAYgBtAGkAdABpAG4AZwAgAGwAbwBnACIAKQA7AA0ACgAgACAAIAAgACAAIAAgACAAUABvAHMAdABEAGEAdABhACgAcwBpAGcAbgBhAHQAdQByAGUALAAgAGoAcwBvAG4ALAAgAGwAbwBnAE4AYQBtAGUALAAgAGQAYQB0AGUAcwB0AHIAaQBuAGcALAAgAHQAaQBtAGUAcwB0AGEAbQBwACkAOwANAAoAIAAgACAAIAB9AA0ACgANAAoAfQA="
      },
      "logAnalytics": {
          "workspace_id": "[parameters('logAnalyticsWorkspaceId')]",
          "shared_key": "[parameters('logAnalyticsSharedKey')]",
          "enabled": "[parameters('logAnalyticsEnabled')]"
      }
  },
  "resources": [
      {
          "type": "Microsoft.Web/sites/functions",
          "name": "[concat(variables('name').site, '/', variables('name').function)]",
          "condition": "[variables('logAnalytics').enabled]",
          "apiVersion": "[variables('apiVersions').functions]",
          "properties": {
              "config": {
                  "bindings": [
                    {
                      "name": "rawmetric",
                      "type": "queueTrigger",
                      "direction": "in",
                      "queueName": "chef-statsd",
                      "connection": "AzureWebJobsStorage"
                    }
                  ],
                  "disabled": false
              },
              "files": {
                  "ChefMetricMessage.csx": "[base64ToString(variables('code').ChefMetricMessage_csx)]",
                  "LogAnalyticsWriter.csx": "[base64ToString(variables('code').LogAnalyticsWriter_csx)]",
                  "workspace.csx": "[concat('static string customerId = \"', variables('logAnalytics').workspace_id, '\";\nstatic string sharedKey = \"', variables('logAnalytics').shared_key, '\";')]",
                  "run.csx": "[base64ToString(variables('code').run_csx)]"
              }
          }
      }
  ],
  "outputs": {
      "name": {
          "type": "string",
          "value": "[if(variables('logAnalytics').enabled, parameters('functionName'), '')]"
      },
      "apiKey": {
          "type": "string",
          "value": "[if(variables('logAnalytics').enabled, listsecrets(resourceId('Microsoft.Web/sites/functions', variables('name').site, variables('name').function), '2016-08-01').key, '')]"
      }
  }
}