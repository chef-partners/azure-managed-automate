{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "siteName": {
            "type": "string",
            "metadata": {
                "description": "Name of the site into which the function should be deployed"
            }
        },
        "functionName": {
            "type": "string",
            "metadata": {
                "description": "name of the function"
            },
            "defaultValue": "NodeCount"
        },
        "logAnalyticsWorkspaceID": {
            "type": "string",
            "metadata": {
                "description": "The workspace ID to use when adding data to Log Analytics"
            }
        },
        "logAnalyticsSharedKey": {
            "type": "securestring",
            "metadata": {
                "description": "Primary key to use for authentication to Log Analytics"
            }
        }
    },
    "variables": {
        "name": {
            "site": "[parameters('siteName')]",
            "function": "[parameters('functionName')]"
        },
        "apiVersions": {
            "functions": "2016-08-01"
        },
        "code": {
            "run_csx": "I3IgIk5ld3RvbnNvZnQuSnNvbiIKI3IgIk1pY3Jvc29mdC5XaW5kb3dzQXp1cmUuU3RvcmFnZSIKI2xvYWQgIndvcmtzcGFjZS5jc3giCiNsb2FkICJjb25zdGFudHMuY3N4IgoKdXNpbmcgU3lzdGVtOwp1c2luZyBTeXN0ZW0uTmV0Owp1c2luZyBTeXN0ZW0uTmV0Lkh0dHA7CnVzaW5nIFN5c3RlbS5OZXQuSHR0cC5IZWFkZXJzOwp1c2luZyBTeXN0ZW0uU2VjdXJpdHkuQ3J5cHRvZ3JhcGh5Owp1c2luZyBTeXN0ZW0uVGV4dDsKdXNpbmcgU3lzdGVtLlRocmVhZGluZy5UYXNrczsKdXNpbmcgTmV3dG9uc29mdC5Kc29uOwp1c2luZyBNaWNyb3NvZnQuV2luZG93c0F6dXJlLlN0b3JhZ2UuVGFibGU7CiAKLy8gQ2xhc3MgZm9yIHdoYXQgc2hvdWxkIGJlIHNlbnQgdG8gTG9nIEFuYWx5dGljcwpwdWJsaWMgY2xhc3MgTm9kZUNvdW50CnsKICAgIHB1YmxpYyBzdHJpbmcgU2VydmVyQWRkcmVzcyB7IGdldDsgc2V0OyB9CiAgICBwdWJsaWMgc3RyaW5nIFNlcnZlclR5cGUgeyBnZXQ7c2V0OyB9CiAgICBwdWJsaWMgaW50IFRvdGFsIHsgZ2V0OyBzZXQ7IH0KICAgIHB1YmxpYyBpbnQgU3VjY2VzcyB7IGdldDsgc2V0OyB9CiAgICBwdWJsaWMgaW50IEZhaWx1cmUgeyBnZXQ7IHNldDsgfQogICAgcHVibGljIGludCBNaXNzaW5nIHsgZ2V0OyBzZXQ7IH0KfQogCnB1YmxpYyBzdGF0aWMgdm9pZCBSdW4oVGltZXJJbmZvIG15VGltZXIsIENsb3VkVGFibGUgc2V0dGluZ1RhYmxlLCBUcmFjZVdyaXRlciBsb2cpCnsKICAgIGxvZy5JbmZvKCJTdGFydCBmdW5jdGlvbiB0byBhZGQgaW5mb3JtYXRpb24gdG8gTG9nIEFuYWx5dGljcyIpOwogCiAgICAvLyBMb2dOYW1lIGlzIG5hbWUgb2YgdGhlIGV2ZW50IHR5cGUgdGhhdCBpcyBiZWluZyBzdWJtaXR0ZWQgdG8gTG9nIEFuYWx5dGljcwogICAgc3RyaW5nIExvZ05hbWUgPSAiQ2hlZkF1dG9tYXRlQU1BSW5mcmFOb2RlQ291bnQiOwoKICAgIFJhbmRvbSBnYXJiYWdlID0gbmV3IFJhbmRvbSgpOwogICAgc3RyaW5nIFNlcnZlclR5cGUgPSAiQXV0b21hdGUiOwogICAgc3RyaW5nIEFkZHJlc3MgPSAiaHR0cHM6Ly9vcHNjaGVmYXV0b21hdGUud2VzdC5jZW50cmFsdXMuY2xvdWRhcHAuYXp1cmUuY29tLyI7CiAgICBpZihnYXJiYWdlLk5leHQoMSwzKSA9PSAxKXsKICAgIFNlcnZlclR5cGUgPSAiQ2hlZiBTZXJ2ZXIiOwogICAgQWRkcmVzcyA9ICJodHRwczovL29wc2NoZWZzZXJ2ZXIud2VzdC5jZW50cmFsdXMuY2xvdWRhcHAuYXp1cmUuY29tLyI7CiAgICB9CgogICAgbG9nLkluZm8oIlNlcnZlciBUeXBlIGlzICIgKyBTZXJ2ZXJUeXBlICsgIiBhbmQgYWRkcmVzcyBpcyAiICsgQWRkcmVzcyk7CgogICAgLy8gR2V0IHRoZSBhdXRvbWF0ZSB0b2tlbiBmcm9tIHRoZSBjb25maWcgc3RvcmUgdGFibGUKICAgIC8vIGFuZCB0aGUgYXV0b21hdGUgRlFETgogICAgVGFibGVPcGVyYXRpb24gdG9rZW5fb3BlcmF0aW9uID0gVGFibGVPcGVyYXRpb24uUmV0cmlldmU8Q29uZmlnS1Y+KFBhcnRpdGlvbktleSwgQXV0b21hdGVUb2tlbktleU5hbWUpOwogICAgVGFibGVSZXN1bHQgdG9rZW5fcmVzdWx0ID0gc2V0dGluZ1RhYmxlLkV4ZWN1dGUodG9rZW5fb3BlcmF0aW9uKTsKCiAgICBUYWJsZU9wZXJhdGlvbiBmcWRuX29wZXJhdGlvbiA9IFRhYmxlT3BlcmF0aW9uLlJldHJpZXZlPENvbmZpZ0tWPihQYXJ0aXRpb25LZXksIEF1dG9tYXRlRlFETktleU5hbWUpOwogICAgVGFibGVSZXN1bHQgZnFkbl9yZXN1bHQgPSBzZXR0aW5nVGFibGUuRXhlY3V0ZShmcWRuX29wZXJhdGlvbik7CgogICAgLy8gaWYgdGhlcmUgaXMgYSByZXN1bHQgZ2V0IHRoZSBrZXkgdmFsdWUsIG90aGVyd2lzZSBsb2cgZXJyb3IKICAgIGlmICh0b2tlbl9yZXN1bHQuUmVzdWx0ICE9IG51bGwgJiYgZnFkbl9yZXN1bHQuUmVzdWx0ICE9IG51bGwpIHsKCiAgICAgICAgLy8gZ2V0IHRoZSB0b2tlbiB2YWx1ZQogICAgICAgIENvbmZpZ0tWIHRva2VuX3NldHRpbmcgPSAoQ29uZmlnS1YpdG9rZW5fcmVzdWx0LlJlc3VsdDsKICAgICAgICBDb25maWdLViBmcWRuX3NldHRpbmcgPSAoQ29uZmlnS1YpZnFkbl9yZXN1bHQuUmVzdWx0OwogICAgICAgIHN0cmluZyBhdXRvbWF0ZV90b2tlbiA9IHRva2VuX3NldHRpbmcuVmFsdWU7CiAgICAgICAgc3RyaW5nIGF1dG9tYXRlX2ZxZG4gPSBmcWRuX3NldHRpbmcuVmFsdWU7CgogICAgICAgIC8vIENyZWF0ZXMgdGhlIEpTT04gb2JqZWN0LCB3aXRoIGtleS92YWx1ZSBwYWlycwogICAgICAgIGxvZy5JbmZvKEdldFN0cmluZ0RhdGEobG9nLCBhdXRvbWF0ZV9mcWRuLCBhdXRvbWF0ZV90b2tlbikpOwogICAgICAgIE5vZGVDb3VudCBqc29uT2JqID0gbmV3IE5vZGVDb3VudCgpOwogICAgICAgIGpzb25PYmogPSBHZXREYXRhKGF1dG9tYXRlX2ZxZG4sIGF1dG9tYXRlX3Rva2VuKTsKICAgICAgICBqc29uT2JqLlNlcnZlclR5cGUgPSBTZXJ2ZXJUeXBlOwogICAgICAgIGpzb25PYmouU2VydmVyQWRkcmVzcyA9IEFkZHJlc3M7CiAgICAgICAgLy8gQ29udmVydCBvYmplY3QgdG8ganNvbgogICAgICAgIHZhciBqc29uID0gSnNvbkNvbnZlcnQuU2VyaWFsaXplT2JqZWN0KGpzb25PYmopOwogICAgCiAgICAgICAgbG9nLkluZm8oImpzb24gZmlsZSBzZW50IHRvIExvZyBBbmFseXRpY3M6ICIgKyBqc29uKTsKICAgICAgICAKICAgICAgICAvLyBDcmVhdGUgYSBoYXNoIGZvciB0aGUgQVBJIHNpZ25hdHVyZQogICAgICAgIHZhciBkYXRlc3RyaW5nID0gRGF0ZVRpbWUuVXRjTm93LlRvU3RyaW5nKCJyIik7CiAgICAgICAgc3RyaW5nIHN0cmluZ1RvSGFzaCA9ICJQT1NUXG4iICsganNvbi5MZW5ndGggKyAiXG5hcHBsaWNhdGlvbi9qc29uXG4iICsgIngtbXMtZGF0ZToiICsgZGF0ZXN0cmluZyArICJcbi9hcGkvbG9ncyI7CiAgICAgICAgc3RyaW5nIGhhc2hlZFN0cmluZyA9IEJ1aWxkU2lnbmF0dXJlKHN0cmluZ1RvSGFzaCwgc2hhcmVkS2V5KTsKICAgICAgICBzdHJpbmcgc2lnbmF0dXJlID0gIlNoYXJlZEtleSAiICsgY3VzdG9tZXJJZCArICI6IiArIGhhc2hlZFN0cmluZzsKICAgIAogICAgICAgIFBvc3REYXRhKHNpZ25hdHVyZSwgZGF0ZXN0cmluZywganNvbiwgY3VzdG9tZXJJZCwgTG9nTmFtZSk7CiAgICB9IGVsc2UgewogICAgICAgIGxvZy5JbmZvKFN0cmluZy5Gb3JtYXQoIlVuYWJsZSB0byBmaW5kIHNlbGVjdGVkIHRva2VuIGluIHRhYmxlOiB7MH0iLCBBdXRvbWF0ZVRva2VuS2V5TmFtZSkpOwogICAgfQp9CiAKLy8gQnVpbGQgdGhlIEFQSSBzaWduYXR1cmUKcHVibGljIHN0YXRpYyBzdHJpbmcgQnVpbGRTaWduYXR1cmUoc3RyaW5nIG1lc3NhZ2UsIHN0cmluZyBzZWNyZXQpCnsKICAgIHZhciBlbmNvZGluZyA9IG5ldyBTeXN0ZW0uVGV4dC5BU0NJSUVuY29kaW5nKCk7CiAgICBieXRlW10ga2V5Qnl0ZSA9IENvbnZlcnQuRnJvbUJhc2U2NFN0cmluZyhzZWNyZXQpOwogICAgYnl0ZVtdIG1lc3NhZ2VCeXRlcyA9IGVuY29kaW5nLkdldEJ5dGVzKG1lc3NhZ2UpOwogICAgdXNpbmcgKHZhciBobWFjc2hhMjU2ID0gbmV3IEhNQUNTSEEyNTYoa2V5Qnl0ZSkpCiAgICB7CiAgICAgICAgYnl0ZVtdIGhhc2ggPSBobWFjc2hhMjU2LkNvbXB1dGVIYXNoKG1lc3NhZ2VCeXRlcyk7CiAgICAgICAgcmV0dXJuIENvbnZlcnQuVG9CYXNlNjRTdHJpbmcoaGFzaCk7CiAgICB9Cn0KIAovLyBTZW5kIGEgcmVxdWVzdCB0byB0aGUgUE9TVCBBUEkgZW5kcG9pbnQKcHVibGljIHN0YXRpYyB2b2lkIFBvc3REYXRhKHN0cmluZyBzaWduYXR1cmUsIHN0cmluZyBkYXRlLCBzdHJpbmcganNvbiwgc3RyaW5nIGN1c3RvbWVySWQsIHN0cmluZyBMb2dOYW1lKQp7CiAgICAvLyBZb3UgY2FuIHVzZSBhbiBvcHRpb25hbCBmaWVsZCB0byBzcGVjaWZ5IHRoZSB0aW1lc3RhbXAgZnJvbSB0aGUgZGF0YS4gSWYgdGhlIHRpbWUgZmllbGQgaXMgbm90IHNwZWNpZmllZCwgTG9nIEFuYWx5dGljcyBhc3N1bWVzIHRoZSB0aW1lIGlzIHRoZSBtZXNzYWdlIGluZ2VzdGlvbiB0aW1lCiAgICBzdHJpbmcgVGltZVN0YW1wRmllbGQgPSAiIjsKICAgIHRyeQogICAgewogICAgICAgIHN0cmluZyB1cmwgPSAiaHR0cHM6Ly8iICsgY3VzdG9tZXJJZCArICIub2RzLm9waW5zaWdodHMuYXp1cmUuY29tL2FwaS9sb2dzP2FwaS12ZXJzaW9uPTIwMTYtMDQtMDEiOwogCiAgICAgICAgU3lzdGVtLk5ldC5IdHRwLkh0dHBDbGllbnQgY2xpZW50ID0gbmV3IFN5c3RlbS5OZXQuSHR0cC5IdHRwQ2xpZW50KCk7CiAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5BZGQoIkFjY2VwdCIsICJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5BZGQoIkxvZy1UeXBlIiwgTG9nTmFtZSk7CiAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5BZGQoIkF1dGhvcml6YXRpb24iLCBzaWduYXR1cmUpOwogICAgICAgIGNsaWVudC5EZWZhdWx0UmVxdWVzdEhlYWRlcnMuQWRkKCJ4LW1zLWRhdGUiLCBkYXRlKTsKICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkFkZCgidGltZS1nZW5lcmF0ZWQtZmllbGQiLCBUaW1lU3RhbXBGaWVsZCk7CiAKICAgICAgICBTeXN0ZW0uTmV0Lkh0dHAuSHR0cENvbnRlbnQgaHR0cENvbnRlbnQgPSBuZXcgU3RyaW5nQ29udGVudChqc29uLCBFbmNvZGluZy5VVEY4KTsKICAgICAgICBodHRwQ29udGVudC5IZWFkZXJzLkNvbnRlbnRUeXBlID0gbmV3IE1lZGlhVHlwZUhlYWRlclZhbHVlKCJhcHBsaWNhdGlvbi9qc29uIik7CiAgICAgICAgVGFzazxTeXN0ZW0uTmV0Lkh0dHAuSHR0cFJlc3BvbnNlTWVzc2FnZT4gcmVzcG9uc2UgPSBjbGllbnQuUG9zdEFzeW5jKG5ldyBVcmkodXJsKSwgaHR0cENvbnRlbnQpOwogCiAgICAgICAgU3lzdGVtLk5ldC5IdHRwLkh0dHBDb250ZW50IHJlc3BvbnNlQ29udGVudCA9IHJlc3BvbnNlLlJlc3VsdC5Db250ZW50OwogICAgICAgIHN0cmluZyByZXN1bHQgPSByZXNwb25zZUNvbnRlbnQuUmVhZEFzU3RyaW5nQXN5bmMoKS5SZXN1bHQ7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlJldHVybiBSZXN1bHQ6ICIgKyByZXN1bHQpOwogICAgfQogICAgY2F0Y2ggKEV4Y2VwdGlvbiBleGNlcCkKICAgIHsKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiQVBJIFBvc3QgRXhjZXB0aW9uOiAiICsgZXhjZXAuTWVzc2FnZSk7CiAgICB9Cn0KCi8vIFNlbmQgYSByZXF1ZXN0IHRvIHRoZSBQT1NUIEFQSSBlbmRwb2ludApwdWJsaWMgc3RhdGljIE5vZGVDb3VudCBHZXREYXRhKHN0cmluZyBhdXRvbWF0ZV9mcWRuLCBzdHJpbmcgdG9rZW4pCnsKICAgIAogICAgTm9kZUNvdW50IG5vZGVDb3VudCA9IG51bGw7CiAgICB0cnkKICAgIHsKICAgICAgICBTZXJ2aWNlUG9pbnRNYW5hZ2VyLlNlcnZlckNlcnRpZmljYXRlVmFsaWRhdGlvbkNhbGxiYWNrICs9IChzZW5kZXIsIGNlcnQsIGNoYWluLCBzc2xQb2xpY3lFcnJvcnMpID0+IHRydWU7CiAgICAgICAgc3RyaW5nIHVybCA9IFN0cmluZy5Gb3JtYXQoImh0dHBzOi8vezB9L2FwaS92MC9jZmdtZ210L3N0YXRzL25vZGVfY291bnRzIiwgYXV0b21hdGVfZnFkbik7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIlBSRVBBUklORyBSRVFVRVNUPT09PT09Iik7CiAgICAgICAgU3lzdGVtLk5ldC5IdHRwLkh0dHBDbGllbnQgY2xpZW50ID0gbmV3IFN5c3RlbS5OZXQuSHR0cC5IdHRwQ2xpZW50KCk7CiAgICAgICAgY2xpZW50LkRlZmF1bHRSZXF1ZXN0SGVhZGVycy5BZGQoIngtZGF0YS1jb2xsZWN0b3ItdG9rZW4iLCB0b2tlbik7CgogICAgICAgICBUYXNrPEh0dHBSZXNwb25zZU1lc3NhZ2U+IHJlc3BvbnNlID0gY2xpZW50LkdldEFzeW5jKG5ldyBVcmkodXJsKSk7CgogICAgICAgIGlmIChyZXNwb25zZS5SZXN1bHQuSXNTdWNjZXNzU3RhdHVzQ29kZSkKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgbm9kZUNvdW50ID0gcmVzcG9uc2UuUmVzdWx0LkNvbnRlbnQuUmVhZEFzQXN5bmM8Tm9kZUNvdW50PigpLlJlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICBDb25zb2xlLldyaXRlTGluZSgiUmV0dXJuIFJlc3VsdDogIiArIHJlc3BvbnNlLlJlc3VsdC5Db250ZW50KTsKICAgIH0KICAgIGNhdGNoIChFeGNlcHRpb24gZXhjZXApCiAgICB7CiAgICAgICAgQ29uc29sZS5Xcml0ZUxpbmUoIkFQSSBQb3N0IEV4Y2VwdGlvbjogIiArIGV4Y2VwLk1lc3NhZ2UpOwogICAgfSAKICAgIHJldHVybiBub2RlQ291bnQ7Cn0KCnB1YmxpYyBzdGF0aWMgc3RyaW5nIEdldFN0cmluZ0RhdGEoVHJhY2VXcml0ZXIgbG9nLCBzdHJpbmcgYXV0b21hdGVfZnFkbiwgc3RyaW5nIHRva2VuKQp7CiAgICAKICAgIHN0cmluZyBub2RlQ291bnQgPSAidW5jaGFuZ2VkIjsKICAgIHRyeQogICAgewogICAgICAgIFNlcnZpY2VQb2ludE1hbmFnZXIuU2VydmVyQ2VydGlmaWNhdGVWYWxpZGF0aW9uQ2FsbGJhY2sgKz0gKHNlbmRlciwgY2VydCwgY2hhaW4sIHNzbFBvbGljeUVycm9ycykgPT4gdHJ1ZTsKICAgICAgICBzdHJpbmcgdXJsID0gU3RyaW5nLkZvcm1hdCgiaHR0cHM6Ly97MH0vYXBpL3YwL2NmZ21nbXQvc3RhdHMvbm9kZV9jb3VudHMiLCBhdXRvbWF0ZV9mcWRuKTsKICAgICAgICBsb2cuSW5mbygiUFJFUEFSSU5HIFJFUVVFU1Q9PT09PT0iKTsKICAgICAgICBTeXN0ZW0uTmV0Lkh0dHAuSHR0cENsaWVudCBjbGllbnQgPSBuZXcgU3lzdGVtLk5ldC5IdHRwLkh0dHBDbGllbnQoKTsKICAgICAgICBjbGllbnQuRGVmYXVsdFJlcXVlc3RIZWFkZXJzLkFkZCgieC1kYXRhLWNvbGxlY3Rvci10b2tlbiIsIHRva2VuKTsKCiAgICAgICAgVGFzazxIdHRwUmVzcG9uc2VNZXNzYWdlPiByZXNwb25zZSA9IGNsaWVudC5HZXRBc3luYyhuZXcgVXJpKHVybCkpOwoKICAgICAgICBpZiAocmVzcG9uc2UuUmVzdWx0LklzU3VjY2Vzc1N0YXR1c0NvZGUpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIG5vZGVDb3VudCA9IHJlc3BvbnNlLlJlc3VsdC5Db250ZW50LlJlYWRBc1N0cmluZ0FzeW5jKCkuUmVzdWx0OwogICAgICAgICAgICB9CgogICAgICAgIGxvZy5JbmZvKCJSZXR1cm4gUmVzdWx0OiAiICsgcmVzcG9uc2UuUmVzdWx0LkNvbnRlbnQpOwogICAgfQogICAgY2F0Y2ggKEV4Y2VwdGlvbiBleGNlcCkKICAgIHsKICAgICAgICBsb2cuSW5mbygiQVBJIEdldCBFeGNlcHRpb246ICIgKyBleGNlcC5NZXNzYWdlKTsKICAgICAgICBub2RlQ291bnQgPSAiZmFpbGVkIjsKICAgIH0gCiAgICByZXR1cm4gbm9kZUNvdW50Owp9CgpwdWJsaWMgY2xhc3MgQ29uZmlnS1YgOiBUYWJsZUVudGl0eSB7CiAgICBwdWJsaWMgc3RyaW5nIFZhbHVlIHsgZ2V0OyBzZXQ7IH0KfQ==",
            "constants_csx": "c3RhdGljIHN0cmluZyBQYXJ0aXRpb25LZXkgPSAiQ2hlZkFNQSI7CnN0YXRpYyBzdHJpbmcgQXV0b21hdGVUb2tlbktleU5hbWUgPSAiYXV0b21hdGVfdG9rZW4iOwpzdGF0aWMgc3RyaW5nIEF1dG9tYXRlRlFETktleU5hbWUgPSAiYXV0b21hdGVfZnFkbiI7"
        },
        "logAnalytics": {
            "workspace_id": "[parameters('logAnalyticsWorkspaceId')]",
            "shared_key": "[parameters('logAnalyticsSharedKey')]"
        }
    },
    "resources": [
        {
            "type": "Microsoft.Web/sites/functions",
            "name": "[concat(variables('name').site, '/', variables('name').function)]",
            "apiVersion": "[variables('apiVersions').functions]",
            "properties": {
                "config": {
                    "bindings": [
                        {
                            "name": "myTimer",
                            "type": "timerTrigger",
                            "direction": "in",
                            "schedule": "0 */5 * * * *"
                        },
                        {
                            "type": "table",
                            "name": "settingTable",
                            "tableName": "settings",
                            "take": 50,
                            "connection": "AzureWebJobsDashboard",
                            "direction": "in"
                        }
                    ],
                    "disabled": false
                },
                "files": {
                    "run.csx": "[base64ToString(variables('code').run_csx)]",
                    "constants.csx": "[base64ToString(variables('code').constants_csx)]",
                    "workspace.csx": "[concat('static string customerId = \"', variables('logAnalytics').workspace_id, '\";\nstatic string sharedKey = \"', variables('logAnalytics').shared_key, '\";')]"
                }
            }
        }
    ],
    "outputs": {
        "name": {
            "type": "string",
            "value": "[parameters('functionName')]"
        },
        "apiKey": {
            "type": "string",
            "value": "[listsecrets(resourceId('Microsoft.Web/sites/functions', variables('name').site, variables('name').function), '2016-08-01').key]"
        }
    }
}